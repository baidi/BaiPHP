<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>JS</title>
<style type="text/css">
</style>
<script type="text/javascript">
(function(p) {
	if (p.bai != null) {
		return;
	}

	Object.prototype.pick = Object.prototype.each = function() {
		return null;
	}
	/** 字符串去除首尾空格 */
	String.prototype.trim = function() {
		return this.replace(/^\s+|\s+$/g, '');
	}
	/** 数组依次执行方法 */
	Array.prototype.each = NodeList.prototype.each = function(action) {
		if (action == null || action.constructor != Function) {
			return;
		}
		var result = null;
		for (var i = 0, m = this.length; i < m; i++) {
			result = action.call(this[i], i);
			if (result === false) {
				break;
			}
		}
	}
	/** 筛选元素 */
	Document.prototype.pick = Element.prototype.pick = function(query, one) {
		if (query == null || query.constructor != String) {
			return null;
		}
		if (one) {
			return this.querySelector(query);
		}
		return this.querySelectorAll(query);
	}
	/** 读取属性 */
	Element.prototype.get = function(item) {
		if (item == null || item.constructor != String) {
			return null;
		}
		if (this.hasAttribute(item)) {
			return this.getAttribute(item);
		}
		return this[item];
	}
	/** 设置属性 */
	Element.prototype.set = function(item, value) {
		if (item == null || item.constructor != String) {
			return null;
		}
		return this[item] = value;
	}
	Element.prototype.on = function(item, action) {
		
	}
	Element.prototype.to = function(options, duration) {

	}

	var $bai = {
		name: 'Bai',
		verson: '1.0.0',
		date: '2012-7-30',
		author: '白晓阳',
		history: ''
	};
	var $own = {};
	var $config = {};
	var error = '一不小心出错啦=_=...';
	$bai.own = function(item, value) {
		if (item == null) {
			return null;
		}
		if (value === undefined) {
			return $own[item];
		}
		return $own[item] = value;
	}
	$bai.config = function() {
		var value = $config;
		// 逐层读取配置
		for ( var i = 0, m = arguments.length; i < m; i++) {
			value = value[arguments[i]];
			if (value == null) {
				return null;
			}
		}
		return value;
	}
	$bai.ajax = function(scope) {

	}
	p.B = p.bai = $bai;
})(window);

if (window.bai != null) {
	bai.check = function() {
		/** 输入项非空检验 */
		var required = function(item) {
			if (item == null || (item.constructor == String && item.trim() == "")
					|| (item.constructor == Array && item.length == 0)) {
				return this.config('Log', 'required');
			}
			return false;
		};

		/** 输入项风险字符检验 */
		var risk = function(item) {
			if (item.constructor == Array) {
				item = item.join('');
			}
			var matcher = new RegExp(this.config('Check', 'risk'));
			if (matcher.exec(item) == null) {
				return this.config('Log', 'risk');
			}
			return false;
		};

		/** 输入项最小长度检验 */
		var min = function(item, len) {
			if (item.constructor == String && item.trim().length < len
					|| item.constructor == Array && item.length < len) {
				return this.config('Log', 'min').replace('%s', len);
			}
			return false;
		};

		/** 输入项最大长度检验 */
		var max = function(item, len) {
			if (item.constructor == String && item.trim().length > len
					|| item.constructor == Array && item.length > len) {
				return this.config('Log', 'max').replace('%s', len);
			}
			return false;
		};

		/** 输入项属性检验 */
		var type = function(item, type) {
			var matcher = new RegExp(this.config('Check', type));
			if (matcher.exec(item) == null) {
				return this.config('Log', 'type');
			}
			return this.config('Log', 'type');
		};

		var checkInput = function() {
			var checks = this.get('data-check') || '';
			checks = checks.split(' ');
			for (var i = 0, m = checks.length; i < m; i++) {
				var params = checks[i].split('=');
				var check = params[0] + "('" + this.value + "'";
				for ( var j = 1; j < params.length; j++) {
					check += ",'" + params[j] + "'";
				}
				check += ")";
				if (_debug) {
					alert(check);
				}
				try {
					message = eval(check);
				} catch (e) {
					if (_debug) {
						alert(e.description);
					}
				}
				if (message) {
					notice.call(this, message);
					return message;
				}
			}
		}
		
		var $check = function(scope) {
			if (scope != null && scope.constructor == String) {
				scope = document.pick(scope, 1);
			}
			if (scope.constructor != Element) {
				return null;
			}
			var types = ['input', 'textarea', 'select'];
			var inputs = null;
			if (types.indexOf(scope.tagName) < 0) {
				inputs = scope.pick('.input');
				if (! inputs.length) {
					return null;
				}
			} else {
				inputs = [scope];
			}
			var data = {};
			var result = false;
			for (var i = 0, m = inputs.length; i < m; i++) {
				data[inputs[i].name] = inputs[i].value;
				result = checkInput.call(inputs[i]);
				if (result) {
					break;
				}
			}
			return {input: inputs[i], result: result};
		};
		return $check;
	}.call(bai);
}

function test() {
	var m = document.pick("#menu1", 1);
	m.set('data-c', 'a');
	var c = m.get('data-b');
	document.pick('span').each(function(i) {
		this.style='border:1px solid #'+i*4+i*4+i*4;
	});
	bai.own('asd', 1);
	bai.own('asd');
}
</script>
</head>
<body>
	<div>
		<span id="menu1">Menu1</span>
		<span>Menu2</span>
		<span>Menu3</span>
	</div>
	<br>
	<div>
		<button onclick="test();">Test</button>
	</div>
</body>
</html>
