/**
 * baislide Bai简单切换
 * 基于jQuery1.6+
 * 版权所有，保留一切权力。未经许可，不得用于商业用途。
 * 
 * @author		白晓阳
 * @copyright	Copyright (c) 2012, 白晓阳
 * @link		http://www.baicode.net
 * @version    V1.2.0 2012/03/22 增加圆角特效，需要CSS3支持
 *              V1.1.1 2012/03/20 修正IE7下切换不正常
 *              V1.1.0 2012/03/19 改善了对Firefox和Opera的支持
 *              V1.0.0 2012/03/18 初版
 */
var baislide={version:"1.2.0",date:"2012/03/22",author:"白晓阳",link:"http://www.baicode.net/",loader:undefined,slidebox:".baislidebox",slidebar:".baislidebar",speed:1500,interval:5000,timeout:undefined,pieces:5,x:[0,"half","full","center","side",{name:"x"}],y:[0,"half","full","center","side",{name:"y"}],w:[0,"half","full",{name:"w"}],h:[0,"half","full",{name:"h"}],r:[0,"half","full",{name:"r"}],bx:[0,"half","full","center","side",{name:"bx"}],by:[0,"half","full","center","side",{name:"by"}],o:[0,1,{name:"o"}],effect:function(item,no){if(item==null||item.length==0||item[item.length-1].name==null)return 0;if(no==null||isNaN(no)||no<0)no=Math.ceil(Math.random()*(item.length-1)-1);var name=item[item.length-1].name;switch(name){case"x":case"w":switch(item[no]){case"half":return this.pwidth/2;case"full":return this.pwidth;case"center":return this.swidth/2;case"side":return this.swidth;default:return item[no]};case"y":case"h":switch(item[no]){case"half":return this.pheight/2;case"full":return this.pheight;case"center":return this.sheight/2;case"side":return this.sheight;default:return item[no]};case"r":switch(item[no]){case"half":return this.pwidth>this.pheight?this.pwidth/ 2 : this.pheight /2;case"full":return this.pwidth>this.pheight?this.pwidth:this.pheight;default:return item[no]};case"bx":switch(item[no]){case"half":return-this.pheight/2;case"full":return-this.pheight;case"center":return-this.sheight/2;case"side":return-this.sheight;default:return item[no]};case"by":switch(item[no]){case"half":return-this.pheight/2;case"full":return-this.pheight;case"center":return-this.sheight/2;case"side":return-this.sheight;default:return item[no]}};return item[no]},add:function(row,col,accord){if(this.on!=null&&this.on){setTimeout("baislide.add("+row+","+col+","+accord+")",this.speed);return};var box=$(this.slidebox,this.loader);var bar=$(this.slidebar,this.loader);if(box.length==0)return;if(this.timeout!=null)clearTimeout(this.timeout);var fore=box.children(":visible");if(fore.length==0){fore=box.children(":first");fore.addClass("on");bar.children(":first").addClass("on")};if(row==null||isNaN(row)){accord=0}else if(col==null||isNaN(col)){accord=1}else{if(accord==null||!accord){accord=2}else{accord=3}};this.length=box.children().length;this.swidth=fore[0].offsetWidth;this.sheight=fore[0].offsetHeight;this.box=box;this.bar=bar;this.accord=accord;if(accord>0){this.row=row;this.pheight=this.sheight/row};if(accord>1){this.col=col;this.pwidth=this.swidth/col};bar.children("a").each(function(i){$(this).click(Function("baislide.slide("+i+")"))});this.timeout=setTimeout("baislide.slide()",this.interval)},slide:function(no){if(this.box==null||this.box.length==0||no<0||no>=this.length)return;if(no!=null&&this.bar.children(":eq("+no+")").hasClass("on"))return;if(this.on){if(no!=null)setTimeout("baislide.slide("+no+")",this.speed);else this.timeout=setTimeout("baislide.slide()",this.interval);return};this.on=true;var fore=this.box.children(":visible");if(fore.length==0){fore=this.box.children(":first");fore.addClass("on");this.bar.children(":first").addClass("on")};var back;if(no!=null&&!isNaN(no)){back=this.box.children(":eq("+no+")");this.bar.children(".on").removeClass("on");this.bar.children(":eq("+no+")").addClass("on")}else{back=fore.next();if(back.length==0)back=this.box.children(":first");var ba=this.bar.children(".on").next();if(ba.length==0)ba=this.bar.children(":first");this.bar.children(".on").removeClass("on");ba.addClass("on");this.timeout=setTimeout("baislide.slide()",this.interval)};if(Math.round(Math.random()))this.slideOut(fore,back);else this.slideIn(fore,back)},slideOut:function(fore,back,accord){if(this.accord<1){this.row=Math.ceil(Math.random()*this.pieces);this.pheight=this.sheight/this.row};if(this.accord<2){this.col=Math.ceil(Math.random()*this.pieces);this.pwidth=this.swidth/this.col};var accord=(this.accord>=3);var ex=this.effect(this.x);var ey=this.effect(this.y);var ew=this.effect(this.w);var eh=this.effect(this.h);var er=this.effect(this.r);var ebx=this.effect(this.bx);var eby=this.effect(this.by);back.show();fore.removeClass("on");fore.hide();for(var r=0;r<this.row;r++){for(var c=0;c<this.col;c++){var piece=$("<div class='on'><div>");piece.css({"left":c*this.pwidth,"top":r*this.pheight,"width":this.pwidth,"height":this.pheight,"border-radius":0,"position":"absolute"});if(c==0&&r==0)piece.html(fore.html());else piece.html(fore.children("img").prop("outerHTML"));piece.children("img").css({"left":-c*this.pwidth,"top":-r*this.pheight,"position":"absolute"});back.before(piece);piece.animate({"left":accord?ex:this.effect(this.x),"top":accord?ey:this.effect(this.y),"width":accord?ew:this.effect(this.w),"height":accord?eh:this.effect(this.h),"border-radius":accord?er:this.effect(this.r),"opacity":0},this.speed,function(){$(this).remove();back.addClass("on");baislide.on=false});piece.children("img").animate({"left":accord?ebx:this.effect(this.bx),"top":accord?eby:this.effect(this.by),},this.speed)}}},slideIn:function(fore,back,accord){if(this.accord<1){this.row=Math.ceil(Math.random()*this.pieces);this.pheight=this.sheight/this.row};if(this.accord<2){this.col=Math.ceil(Math.random()*this.pieces);this.pwidth=this.swidth/this.col};var accord=(this.accord>=3);var ex=this.effect(this.x);var ey=this.effect(this.y);var ew=this.effect(this.w);var eh=this.effect(this.h);var er=this.effect(this.r);var ebx=this.effect(this.bx);var eby=this.effect(this.by);fore.removeClass("on");fore.show();for(var r=0;r<this.row;r++){for(var c=0;c<this.col;c++){var piece=$("<div class='on'><div>");piece.css({"left":accord?ex:this.effect(this.x),"top":accord?ey:this.effect(this.y),"width":accord?ew:this.effect(this.w),"height":accord?eh:this.effect(this.h),"border-radius":accord?er:this.effect(this.r),"opacity":0,"position":"absolute"});if(c==0&&r==0)piece.html(back.html());else piece.html(back.children("img").prop("outerHTML"));piece.children("img").css({"left":accord?ebx:this.effect(this.bx),"top":accord?eby:this.effect(this.by),"position":"absolute"});fore.before(piece);piece.animate({"left":c*this.pwidth,"top":r*this.pheight,"width":this.pwidth,"height":this.pheight,"border-radius":0,"opacity":1},this.speed,function(){$(this).remove();back.addClass("on");back.show();fore.hide();baislide.on=false});piece.children("img").animate({"left":-c*this.pwidth,"top":-r*this.pheight},this.speed)}}}};
